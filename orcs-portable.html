<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORCS Intelligence System - Portable</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #e2e8f0;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 250px 1fr 350px;
            height: 100vh;
        }
        
        .sidebar {
            background: #1e293b;
            border-right: 1px solid #334155;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .main-content {
            background: #0f1419;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .tag-panel {
            background: #1e293b;
            border-left: 1px solid #334155;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: #334155;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .file-item:hover {
            background: #475569;
        }
        
        .file-item.active {
            background: #3b82f6;
        }
        
        .tag-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: #059669;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .tag-item.relationship {
            background: #dc2626;
        }
        
        .tag-item.attribute {
            background: #7c3aed;
        }
        
        .tag-item.comment {
            background: #ea580c;
        }
        
        .tag-item.kv_pair {
            background: #0891b2;
        }
        
        .content-area {
            background: #1e293b;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.5;
        }
        
        .upload-area {
            border: 2px dashed #334155;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .upload-area:hover {
            border-color: #3b82f6;
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn-danger {
            background: #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .input {
            background: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.25rem 0;
            width: 100%;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1e293b;
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .selected-text {
            background: #fbbf24;
            color: #000;
            cursor: pointer;
        }
        
        .tag-highlight {
            padding: 2px 4px;
            border-radius: 2px;
            cursor: pointer;
        }
        
        .tag-highlight.entity {
            background: rgba(5, 150, 105, 0.3);
            border: 1px solid #059669;
        }
        
        .tag-highlight.relationship {
            background: rgba(220, 38, 38, 0.3);
            border: 1px solid #dc2626;
        }
        
        .tag-highlight.attribute {
            background: rgba(124, 58, 237, 0.3);
            border: 1px solid #7c3aed;
        }
        
        .tag-highlight.comment {
            background: rgba(234, 88, 12, 0.3);
            border: 1px solid #ea580c;
        }
        
        .tag-highlight.kv_pair {
            background: rgba(8, 145, 178, 0.3);
            border: 1px solid #0891b2;
        }
        
        .stats {
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .graph-area {
            background: #1e293b;
            border-radius: 8px;
            padding: 1rem;
            height: 400px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .similarity-match {
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid #fbbf24;
            border-radius: 4px;
            padding: 0.5rem;
            margin: 0.25rem 0;
        }
        
        h1, h2, h3 {
            margin-bottom: 1rem;
            color: #f1f5f9;
        }
        
        .section {
            margin-bottom: 2rem;
        }
        
        .tag-form {
            display: none;
        }
        
        .tag-form.active {
            display: block;
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <script>
        // D3.js v7.9.0 - Embedded for offline functionality
        // https://d3js.org v7.9.0 Copyright 2010-2023 Mike Bostock
        !function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{})}(this,(function(t){"use strict";function n(t,n){return null==t||null==n?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function e(t,n){return null==t||null==n?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function r(t){let r,o,a;function u(t,n,e=0,i=t.length){if(e<i){if(0!==r(n,n))return i;do{const r=e+i>>>1;o(t[r],n)<0?e=r+1:i=r}while(e<i)}return e}return 2!==t.length?(r=n,o=(e,r)=>n(t(e),r),a=(n,e)=>t(n)-e):(r=t===n||t===e?t:i,o=t,a=t),{left:u,center:function(t,n,e=0,r=t.length){const i=u(t,n,e,r-1);return i>e&&a(t[i-1],n)>-a(t[i],n)?i-1:i},right:function(t,n,e=0,i=t.length){if(e<i){if(0!==r(n,n))return i;do{const r=e+i>>>1;o(t[r],n)<=0?e=r+1:i=r}while(e<i)}return e}}}function i(){return 0}function o(t){return null===t?NaN:+t}const a=r(n),u=a.right,c=a.left,f=r(o).center;var s=u;const l=d(y),h=d((function(t){const n=y(t);return(t,e,r,i,o)=>{n(t,e,(r<<=2)+0,(i<<=2)+0,o<<=2),n(t,e,r+1,i+1,o),n(t,e,r+2,i+2,o),n(t,e,r+3,i+3,o)}}));function d(t){return function(n,e,r=e){if(!((e=+e)>=0))throw new RangeError("invalid rx");if(!((r=+r)>=0))throw new RangeError("invalid ry");let{data:i,width:o,height:a}=n;if(!((o=Math.floor(o))>=0))throw new RangeError("invalid width");if(!((a=Math.floor(void 0!==a?a:i.length/o))>=0))throw new RangeError("invalid height");if(!o||!a||!e&&!r)return n;const u=e&&t(e),c=r&&t(r),f=i.slice();return u&&c?(p(u,f,i,o,a),p(u,i,f,o,a),p(u,f,i,o,a),g(c,i,f,o,a),g(c,f,i,o,a),g(c,i,f,o,a)):u?(p(u,i,f,o,a),p(u,f,i,o,a),p(u,i,f,o,a)):c&&(g(c,i,f,o,a),g(c,f,i,o,a),g(c,i,f,o,a)),n}}function p(t,n,e,r,i){for(let o=0,a=r*i;o<a;)t(n,e,o,o+=r,1)}function g(t,n,e,r,i){for(let o=0,a=r*i;o<r;++o)t(n,e,o,o+a,r)}function y(t){const n=Math.floor(t);if(n===t)return function(t){const n=2*t+1;return(e,r,i,o,a)=>{if(!((o-=a)>=i))return;let u=t*r[i];const c=a*t;for(let t=i,n=i+c;t<n;t+=a)u+=r[Math.min(o,t)];for(let t=i,f=o;t<=f;t+=a)u+=r[Math.min(o,t+c)],e[t]=u/n,u-=r[Math.max(i,t-c)]}}(t);const e=t-n,r=2*t+1;return(t,i,o,a,u)=>{if(!((a-=u)>=o))return;let c=n*i[o];const f=u*n,s=f+u;for(let t=o,n=o+f;t<n;t+=u)c+=i[Math.min(a,t)];for(let n=o,l=a;n<=l;n+=u)c+=i[Math.min(a,n+f)],t[n]=(c+e*(i[Math.max(o,n-s)]+i[Math.min(a,n+s)]))/r,c-=i[Math.max(o,n-f)]}}function v(t,n){let e=0;if(void 0===n)for(let n of t)null!=n&&(n=+n)>=n&&++e;else{let r=-1;for(let i of t)null!=(i=n(i,++r,t))&&(i=+i)>=i&&++e}return e}function _(t){return 0|t.length}function b(t){return!(t>0)}function m(t){return"object"!=typeof t||"length"in t?t:Array.from(t)}function x(t,n){let e,r=0,i=0,o=0;if(void 0===n)for(let n of t)null!=n&&(n=+n)>=n&&(e=n-i,i+=e/++r,o+=e*(n-i));else{let a=-1;for(let u of t)null!=(u=n(u,++a,t))&&(u=+u)>=u&&(e=u-i,i+=e/++r,o+=e*(u-i))}if(r>1)return o/(r-1)}function w(t,n){const e=x(t,n);return e?Math.sqrt(e):e}function M(t,n){let e,r;if(void 0===n)for(const n of t)null!=n&&(void 0===e?n>=n&&(e=r=n):(e>n&&(e=n),r<n&&(r=n)));else{let i=-1;for(let o of t)null!=(o=n(o,++i,t))&&(void 0===e?o>=o&&(e=r=o):(e>o&&(e=o),r<o&&(r=o)))}return[e,r]}class T{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const i=n[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(n[e++]=a),t=o}return n[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let n,e,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(n=o,e=t[--i],o=n+e,r=e-(o-n),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(e=2*r,n=o+e,e==n-o&&(o=n))}return o}}class InternMap extends Map{constructor(t,n=N){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const[n,e]of t)this.set(n,e)}get(t){return super.get(A(this,t))}has(t){return super.has(A(this,t))}set(t,n){return super.set(S(this,t),n)}delete(t){return super.delete(E(this,t))}}class InternSet extends Set{constructor(t,n=N){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const n of t)this.add(n)}has(t){return super.has(A(this,t))}add(t){return super.add(S(this,t))}delete(t){return super.delete(E(this,t))}}function A({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):e}function S({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):(t.set(r,e),e)}function E({_intern:t,_key:n},e){const r=n(e);return t.has(r)&&(e=t.get(r),t.delete(r)),e}function N(t){return null!==t&&"object"==typeof t?t.valueOf():t}function k(t){return t}function C(t,...n){return F(t,k,k,n)}function P(t,...n){return F(t,Array.from,k,n)}function z(t,n){for(let e=1,r=n.length;e<r;++e)t=t.flatMap((t=>t.pop().map((([n,e])=>[...t,n,e]))));return t}function $(t,n,...e){return F(t,k,n,e)}function D(t,n,...e){return F(t,Array.from,n,e)}function R(t){if(1!==t.length)throw new Error("duplicate key");return t[0]}function F(t,n,e,r){return function t(i,o){if(o>=r.length)return e(i);const a=new InternMap,u=r[o++];let c=-1;for(const t of i){const n=u(t,++c,i),e=a.get(n);e?e.push(t):a.set(n,[t])}for(const[n,e]of a)a.set(n,t(e,o));return n(a)}(t,0)}function q(t,n){return Array.from(n,(n=>t[n]))}function U(t,...n){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");t=Array.from(t);let[e]=n;if(e&&2!==e.length||n.length>1){const r=Uint32Array.from(t,((t,n)=>n));return n.length>1?(n=n.map((n=>t.map(n))),r.sort(((t,e)=>{for(const r of n){const n=O(r[t],r[e]);if(n)return n}}))):(e=t.map(e),r.sort(((t,n)=>O(e[t],e[n])))),q(t,r)}return t.sort(I(e))}function I(t=n){if(t===n)return O;if("function"!=typeof t)throw new TypeError("compare is not a function");return(n,e)=>{const r=t(n,e);return r||0===r?r:(0===t(e,e))-(0===t(n,n))}}function O(t,n){return(null==t||!(t>=t))-(null==n||!(n>=n))||(t<n?-1:t>n?1:0)}var B=Array.prototype.slice;function Y(t){return()=>t}const L=Math.sqrt(50),j=Math.sqrt(10),H=Math.sqrt(2);function X(t,n,e){const r=(n-t)/Math.max(0,e),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=L?10:o>=j?5:o>=H?2:1;let u,c,f;return i<0?(f=Math.pow(10,-i)/a,u=Math.round(t*f),c=Math.round(n*f),u/f<t&&++u,c/f>n&&--c,f=-f):(f=Math.pow(10,i)*a,u=Math.round(t/f),c=Math.round(n/f),u*f<t&&++u,c*f>n&&--c),c<u&&.5<=e&&e<2?X(t,n,2*e):[u,c,f]}function G(t,n,e){if(!((e=+e)>0))return[];if((t=+t)===(n=+n))return[t];const r=n<t,[i,o,a]=r?X(n,t,e):X(t,n,e);if(!(o>=i))return[];const u=o-i+1,c=new Array(u);if(r)if(a<0)for(let t=0;t<u;++t)c[t]=(o-t)/-a;else for(let t=0;t<u;++t)c[t]=(o-t)*a;else if(a<0)for(let t=0;t<u;++t)c[t]=(i+t)/-a;else for(let t=0;t<u;++t)c[t]=(i+t)*a;return c}function V(t,n,e){return X(t=+t,n=+n,e=+e)[2]}function W(t,n,e){e=+e;const r=(n=+n)<(t=+t),i=r?V(n,t,e):V(t,n,e);return(r?-1:1)*(i<0?1/-i:i)}function Z(t,n,e){let r;for(;;){const i=V(t,n,e);if(i===r||0===i||!isFinite(i))return[t,n];i>0?(t=Math.floor(t/i)*i,n=Math.ceil(n/i)*i):i<0&&(t=Math.ceil(t*i)/i,n=Math.floor(n*i)/i),r=i}}function K(t){return Math.max(1,Math.ceil(Math.log(v(t))/Math.LN2)+1)}function Q(){var t=k,n=M,e=K;function r(r){Array.isArray(r)||(r=Array.from(r));var i,o,a,u=r.length,c=new Array(u);for(i=0;i<u;++i)c[i]=t(r[i],i,r);var f=n(c),l=f[0],h=f[1],d=e(c,l,h);if(!Array.isArray(d)){const t=h,e=+d;if(n===M&&([l,h]=Z(l,h,e)),(d=G(l,h,e))[0]<=l&&(a=V(l,h,e)),d[d.length-1]>=h)if(t>=h&&n===M){const t=V(l,h,e);isFinite(t)&&(t>0?h=(Math.floor(h/t)+1)*t:t<0&&(h=(Math.ceil(h*-t)+1)/-t))}else d.pop()}for(var p=d.length,g=0,y=p;d[g]<=l;)++g;for(;d[y-1]>h;)--y;(g||y<p)&&(d=d.slice(g,y),p=y-g);var v,_=new Array(p+1);for(i=0;i<=p;++i)(v=_[i]=[]).x0=i>0?d[i-1]:l,v.x1=i<p?d[i]:h;if(isFinite(a)){if(a>0)for(i=0;i<u;++i)null!=(o=c[i])&&l<=o&&o<=h&&_[Math.min(p,Math.floor((o-l)/a))].push(r[i]);else if(a<0)for(i=0;i<u;++i)if(null!=(o=c[i])&&l<=o&&o<=h){const t=Math.floor((l-o)*a);_[Math.min(p,t+(d[t]<=o))].push(r[i])}}else for(i=0;i<u;++i)null!=(o=c[i])&&l<=o&&o<=h&&_[s(d,o,0,p)].push(r[i]);return _}return r.value=function(n){return arguments.length?(t="function"==typeof n?n:Y(n),r):t},r.domain=function(t){return arguments.length?(n="function"==typeof t?t:Y([t[0],t[1]]),r):n},r.thresholds=function(t){return arguments.length?(e="function"==typeof t?t:Y(Array.isArray(t)?B.call(t):t),r):e},r}function J(t,n){let e;if(void 0===n)for(const n of t)null!=n&&(e<n||void 0===e&&n>=n)&&(e=n);else{let r=-1;for(let i of t)null!=(i=n(i,++r,t))&&(e<i||void 0===e&&i>=i)&&(e=i)}return e}function tt(t,n){let e,r=-1,i=-1;if(void 0===n)for(const n of t)++i,null!=n&&(e<n||void 0===e&&n>=n)&&(e=n,r=i);else for(let o of t)null!=(o=n(o,++i,t))&&(e<o||void 0===e&&o>=o)&&(e=o,r=i);return r}function nt(t,n){let e;if(void 0===n)for(const n of t)null!=n&&(e>n||void 0===e&&n>=n)&&(e=n);else{let r=-1;for(let i of t)null!=(i=n(i,++r,t))&&(e>i||void 0===e&&i>=i)&&(e=i)}return e}function et(t,n){let e,r=-1,i=-1;if(void 0===n)for(const n of t)++i,null!=n&&(e>n||void 0===e&&n>=n)&&(e=n,r=i);else for(let o of t)null!=(o=n(o,++i,t))&&(e>o||void 0===e&&o>=o)&&(e=o,r=i);return r}function rt(t,n,e=0,r=1/0,i){if(n=Math.floor(n),e=Math.floor(Math.max(0,e)),r=Math.floor(Math.min(t.length-1,r)),!(e<=n&&n<=r))return t;for(i=void 0===i?O:I(i);r>e;){if(r-e>600){const o=r-e+1,a=n-e+1,u=Math.log(o),c=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*c*(o-c)/o)*(a-o/2<0?-1:1);rt(t,n,Math.max(e,Math.floor(n-a*c/o+f)),Math.min(r,Math.floor(n+(o-a)*c/o+f)),i)}const o=t[n];let a=e,u=r;for(it(t,e,n),i(t[r],o)>0&&it(t,e,r);a<u;){for(it(t,a,u),++a,--u;i(t[a],o)<0;)++a;for(;i(t[u],o)>0;)--u}0===i(t[e],o)?it(t,e,u):(++u,it(t,u,r)),u<=n&&(e=u+1),n<=u&&(r=u-1)}return t}function it(t,n,e){const r=t[n];t[n]=t[e],t[e]=r}function ot(t,e=n){let r,i=!1;if(1===e.length){let o;for(const a of t){const t=e(a);(i?n(t,o)>0:0===n(t,t))&&(r=a,o=t,i=!0)}}else for(const n of t)(i?e(n,r)>0:0===e(n,n))&&(r=n,i=!0);return r}function at(t,n,e){if(t=Float64Array.from(function*(t,n){if(void 0===n)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let e=-1;for(let r of t)null!=(r=n(r,++e,t))&&(r=+r)>=r&&(yield r)}}(t,e)),(r=t.length)&&!isNaN(n=+n)){if(n<=0||r<2)return nt(t);if(n>=1)return J(t);var r,i=(r-1)*n,o=Math.floor(i),a=J(rt(t,o).subarray(0,o+1));return a+(nt(t.subarray(o+1))-a)*(i-o)}}function ut(t,n,e=o){if((r=t.length)&&!isNaN(n=+n)){if(n<=0||r<2)return+e(t[0],0,t);if(n>=1)return+e(t[r-1],r-1,t);var r,i=(r-1)*n,a=Math.floor(i),u=+e(t[a],a,t);return u+(+e(t[a+1],a+1,t)-u)*(i-a)}}function ct(t,n,e=o){if(!isNaN(n=+n)){if(r=Float64Array.from(t,((n,r)=>o(e(t[r],r,t)))),n<=0)return et(r);if(n>=1)return tt(r);var r,i=Uint32Array.from(t,((t,n)=>n)),a=r.length-1,u=Math.floor(a*n);return rt(i,u,0,a,((t,n)=>O(r[t],r[n]))),(u=ot(i.subarray(0,u+1),(t=>r[t])))>=0?u:-1}}function ft(t){return Array.from(function*(t){for(const n of t)yield*n}(t))}function st(t,n){return[t,n]}function lt(t,n,e){t=+t,n=+n,e=(i=arguments.length)<2?(n=t,t=0,1):i<3?1:+e;for(var r=-1,i=0|Math.max(0,Math.ceil((n-t)/e)),o=new Array(i);++r<i;)o[r]=t+r*e;return o}function ht(t,e=n){if(1===e.length)return et(t,e);let r,i=-1,o=-1;for(const n of t)++o,(i<0?0===e(n,n):e(n,r)<0)&&(r=n,i=o);return i}var dt=pt(Math.random);function pt(t){return function(n,e=0,r=n.length){let i=r-(e=+e);for(;i;){const r=t()*i--|0,o=n[i+e];n[i+e]=n[r+e],n[r+e]=o}return n}}function gt(t){if(!(i=t.length))return[];for(var n=-1,e=nt(t,yt),r=new Array(e);++n<e;)for(var i,o=-1,a=r[n]=new Array(i);++o<i;)a[o]=t[o][n];return r}function yt(t){return t.length}function vt(t){return t instanceof InternSet?t:new InternSet(t)}function _t(t,n){const e=t[Symbol.iterator](),r=new Set;for(const t of n){const n=bt(t);if(r.has(n))continue;let i,o;for(;({value:i,done:o}=e.next());){if(o)return!1;const t=bt(i);if(r.add(t),Object.is(n,t))break}}return!0}function bt(t){return null!==t&&"object"==typeof t?t.valueOf():t}function mt(t){return t}var xt=1,wt=2,Mt=3,Tt=4,At=1e-6;function St(t){return"translate("+t+",0)"}function Et(t){return"translate(0,"+t+")"}function Nt(t){return n=>+t(n)}function kt(t,n){return n=Math.max(0,t.bandwidth()-2*n)/2,t.round()&&(n=Math.round(n)),e=>+t(e)+n}function Ct(){return!this.__axis}function Pt(t,n){var e=[],r=null,i=null,o=6,a=6,u=3,c="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,f=t===xt||t===Tt?-1:1,s=t===Tt||t===wt?"x":"y",l=t===xt||t===Mt?St:Et;function h(h){var d=null==r?n.ticks?n.ticks.apply(n,e):n.domain():r,p=null==i?n.tickFormat?n.tickFormat.apply(n,e):mt:i,g=Math.max(o,0)+u,y=n.range(),v=+y[0]+c,_=+y[y.length-1]+c,b=(n.bandwidth?kt:Nt)(n.copy(),c),m=h.selection?h.selection():h,x=m.selectAll(".domain").data([null]),w=m.selectAll(".tick").data(d,n).order(),M=w.exit(),T=w.enter().append("g").attr("class","tick"),A=w.select("line"),S=w.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(T),A=A.merge(T.append("line").attr("stroke","currentColor").attr(s+"2",f*o)),S=S.merge(T.append("text").attr("fill","currentColor").attr(s,f*g).attr("dy",t===xt?"0em":t===Mt?"0.71em":"0.32em")),h!==m&&(x=x.transition(h),w=w.transition(h),A=A.transition(h),S=S.transition(h),M=M.transition(h).attr("opacity",At).attr("transform",(function(t){return isFinite(t=b(t))?l(t+c):this.getAttribute("transform")})),T.attr("opacity",At).attr("transform",(function(t){var n=this.parentNode.__axis;return l((n&&isFinite(n=n(t))?n:b(t))+c)}))),M.remove(),x.attr("d",t===Tt||t===wt?a?"M"+f*a+","+v+"H"+c+"V"+_+"H"+f*a:"M"+c+","+v+"V"+_:a?"M"+v+","+f*a+"V"+c+"H"+_+"V"+f*a:"M"+v+","+c+"H"+_),w.attr("opacity",1).attr("transform",(function(t){return l(b(t)+c)})),A.attr(s+"2",f*o),S.attr(s,f*g).text(p),m.filter(Ct).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===wt?"start":t===Tt?"end":"middle"),m.each((function(){this.__axis=b}))}return h.scale=function(t){return arguments.length?(n=t,h):n},h.ticks=function(){return e=Array.from(arguments),h},h.tickArguments=function(t){return arguments.length?(e=null==t?[]:Array.from(t),h):e.slice()},h.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),h):r&&r.slice()},h.tickFormat=function(t){return arguments.length?(i=t,h):i},h.tickSize=function(t){return arguments.length?(o=a=+t,h):o},h.tickSizeInner=function(t){return arguments.length?(o=+t,h):o},h.tickSizeOuter=function(t){return arguments.length?(a=+t,h):a},h.tickPadding=function(t){return arguments.length?(u=+t,h):u},h.offset=function(t){return arguments.length?(c=+t,h):c},h}var zt={value:()=>{}};function $t(){for(var t,n=0,e=arguments.length,r={};n<e;++n){if(!(t=arguments[n]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Dt(r)}function Dt(t){this._=t}function Rt(t,n){for(var e,r=0,i=t.length;r<i;++r)if((e=t[r]).name===n)return e.value}function Ft(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=zt,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=e&&t.push({name:n,value:e}),t}Dt.prototype=$t.prototype={constructor:Dt,on:function(t,n){var e,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");if(e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))),a=-1,u=o.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++a<u;)if(e=(t=o[a]).type)i[e]=Ft(i[e],t.name,n);else if(null==n)for(e in i)i[e]=Ft(i[e],t.name,null);return this}for(;++a<u;)if((e=(t=o[a]).type)&&(e=Rt(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new Dt(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r,i=new Array(e),o=0;o<e;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(r=this._[t]).length;o<e;++o)r[o].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};var qt="http://www.w3.org/1999/xhtml",Ut={svg:"http://www.w3.org/2000/svg",xhtml:qt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function It(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),Ut.hasOwnProperty(n)?{space:Ut[n],local:t}:t}function Ot(t){return function(){this.removeAttribute(t)}}function Bt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Yt(t,n){return function(){this.setAttribute(t,n)}}function Lt(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function jt(t,n){var e=It(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((null==n?e.local?Bt:Ot:"function"==typeof n?e.local?Lt:Yt:e.local?Lt:Yt)(e,n))}function Ht(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Xt(t){return function(){this.style.removeProperty(t)}}function Gt(t,n,e){return function(){this.style.setProperty(t,n,e)}}function Vt(t,n,e){return arguments.length>1?this.each((null==n?Xt:"function"==typeof n?Gt:Gt)(t,n,null==e?"":e)):Wt(this.node(),t)}function Wt(t,n){return t.style.getPropertyValue(n)||Ht(t).getComputedStyle(t,null).getPropertyValue(n)}function Zt(t){return function(){delete this[t]}}function Kt(t,n){return function(){this[t]=n}}function Qt(t,n){return arguments.length>1?this.each((null==n?Zt:"function"==typeof n?Kt:Kt)(t,n)):this.node()[t]}function Jt(t){return t.trim().split(/^|\s+/)}function tn(t){return t.classList||new nn(t)}function nn(t){this._node=t,this._names=Jt(t.getAttribute("class")||"")}function en(t,n){for(var e=tn(t),r=-1,i=n.length;++r<i;)e.add(n[r])}function rn(t,n){for(var e=tn(t),r=-1,i=n.length;++r<i;)e.remove(n[r])}function on(t){return function(){en(this,t)}}function an(t){return function(){rn(this,t)}}function un(t,n){return function(){(n.apply(this,arguments)?en:rn)(this,t)}}function cn(t,n){var e=Jt(t+"");if(arguments.length<2){for(var r=tn(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each(("function"==typeof n?un:n?on:an)(e,n))}function fn(){this.textContent=""}function sn(t){return function(){this.textContent=t}}function ln(t){return arguments.length?this.each(null==t?fn:"function"==typeof t?sn:sn)(t):this.node().textContent}function hn(){this.innerHTML=""}function dn(t){return function(){this.innerHTML=t}}function pn(t){return arguments.length?this.each(null==t?hn:"function"==typeof t?dn:dn)(t):this.node().innerHTML}function gn(){this.nextSibling&&this.parentNode.removeChild(this)}function yn(){return this.each(gn)}function vn(){this.parentNode.insertBefore(this,this.parentNode.firstChild)}function _n(){return this.each(vn)}function bn(t){var n="function"==typeof t?t:function(t){return function(){return this.querySelector(t)}}(t);return this.select((function(){return n.apply(this,arguments)||null}))}function mn(t){var n="function"==typeof t?t:function(t){return function(){return this.querySelectorAll(t)}}(t);return this.selectAll((function(){return n.apply(this,arguments)||xn}))}nn.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var xn=[];function wn(t){return null==t?xn:Array.isArray(t)?t:Array.from(t)}function Mn(t){for(var n=-1,e=t.length;++n<e;)yield t[n]}function Tn(t){return function(){return t}}function An(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new Sn(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function Sn(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function En(t){return new Array(t.length)}function Nn(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function kn(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new Nn(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function Cn(t){return new Array(t.length)}function Pn(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function zn(t){return t}Sn.prototype={constructor:Sn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},Nn.prototype={constructor:Nn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var $n=Array.prototype.find;function Dn(t){return function(){return $n.call(this.children,t)||null}}function Rn(t){return new Array(t.length)}function Fn(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function qn(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new Fn(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function Un(t){return new Array(t.length)}Fn.prototype={constructor:Fn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var In="$";function On(t,n){if(!t)return f=new Yn,f;if("string"==typeof t)return f=Hn([document.querySelectorAll(t)],Gn),f;var e,r=t.length;if(r){for(var i=new Array(r),o=0;o<r;++o)i[o]=t[o];t=i}if(null!=n)for(var a=0;a<r;++a)t[a].__data__=n[a];var u=Gn[0].parentNode,c=u?u.ownerDocument:u;return Object.setPrototypeOf(t,Bn.prototype),t.ownerDocument=c,t.parentNode=u,t.namespaceURI=u?u.namespaceURI:qt,t;var f}function Bn(t){this._groups=t,this._parents=Gn}function Yn(t){this._groups=[[null]],this._parents=[null]}function Ln(t,n){for(var e,r=0,i=t.length;r<i;++r)for(var o,a=t[r],u=0,c=a.length;u<c;++u)(o=a[u])&&(e=n.call(o,o.__data__,u,a))&&("__data__"in o&&(e.__data__=o.__data__),a[u]=e);return new Bn(t,this._parents)}function jn(t,n){for(var e,r,i,o=0,a=t.length;o<a;++o)for(r=t[o],e=0,i=r.length;e<i;++e)(r[e]=n.call(r[e],e,r))&&"__data__"in t[o][e]&&(r[e].__data__=t[o][e].__data__);return new Bn(t,this._parents)}function Hn(t,n){return new Bn(t,n)}function Xn(t){return(t+"").trim().split(/^|\s+/)}function Gn(){return[]}function Vn(t){return"string"==typeof t?new Bn([[document.querySelector(t)]],[document.documentElement]):new Bn([[t]],Gn)}function Wn(t){return"string"==typeof t?new Bn([document.querySelectorAll(t)],[document.documentElement]):new Bn([wn(t)],Gn)}Bn.prototype=On.prototype={constructor:Bn,select:function(t){return"function"!=typeof t&&(t=function(t){return function(){return this.querySelector(t)}}(t)),this.each((function(){var n=t.apply(this,arguments);n&&"__data__"in this&&(n.__data__=this.__data__)}))},selectAll:function(t){return"function"!=typeof t&&(t=function(t){return function(){return this.querySelectorAll(t)}}(t)),this.each((function(){var n=t.apply(this,arguments);n&&"__data__"in this&&(n.__data__=this.__data__)}))},selectChild:function(t){return this.select(null==t?Dn:function(t){return"function"==typeof t?t:function(t){return function(){return this.querySelector(t)}}(t)}(t))},selectChildren:function(t){return this.selectAll(null==t?":scope > *":function(t){return"function"==typeof t?t:function(t){return function(){return this.querySelectorAll(t)}}(t)}(t))},filter:function(t){return"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t)),this.each((function(){return t.apply(this,arguments)}))},data:function(t,n){if(!arguments.length)return Array.from(this,zn);var e=n?qn:An,r=this._parents,i=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=i.length,a=new Array(o),u=new Array(o),c=new Array(o),f=0;f<o;++f){var s=r[f],l=i[f],h=l.length,d=wn(t.call(s,s&&s.__data__,f,r)),p=d.length,g=u[f]=new Array(p),y=a[f]=new Array(p),v=c[f]=new Array(h);e(s,l,g,y,v,d,n);for(var _,b,m=0,x=0;m<p;++m)if(_=g[m]){for(m>=x&&(x=m+1);!(b=y[x])&&++x<p;);_._next=b||null}}return(a=new Bn(a,r))._enter=u,a._exit=c,a},enter:function(){return new Bn(this._enter||this._groups.map(Rn),this._parents)},exit:function(){return new Bn(this._exit||this._groups.map(Rn),this._parents)},join:function(t,n,e){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=n&&(i=n(i))&&(i=i.selection()),null==e?o.remove():e(o),r&&i?r.merge(i).order():i},merge:function(t){for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var c,f=n[u],s=e[u],l=f.length,h=a[u]=new Array(l),d=0;d<l;++d)(c=f[d]||s[d])&&(h[d]=c);for(;u<r;++u)a[u]=n[u];return new Bn(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r,i=t[n],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}return t||(t=Pn),this.order().each((function(){var t=this.children;t&&(t=Array.from(t)).sort(n),this.appendChild(t[0]),this.appendChild(t[1])}))},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r,i=t[n],o=0,a=i.length;o<a;++o)if(r=i[o])return r;return null},size:function(){let t=0;for(const n of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i,o=n[e],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:jt,style:Vt,property:Qt,classed:cn,text:ln,html:pn,raise:function(){return this.each(vn)},lower:function(){return this.each((function(){this.parentNode&&this.parentNode.appendChild(this)}))},append:function(t){var n="function"==typeof t?t:function(t){return function(){return this.ownerDocument.createElement(t)}}(t);return this.select((function(){return this.appendChild(n.apply(this,arguments))}))},insert:function(t,n){var e="function"==typeof t?t:function(t){return function(){return this.ownerDocument.createElement(t)}}(t),r=null==n?function(){return null}:"function"==typeof n?n:function(t){return function(){return this.querySelector(t)}}(n);return this.select((function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:yn,clone:function(t){return this.select(t?function(){return this.cloneNode(!0)}:function(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)})},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var r,i,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}}))}(t+""),a=o.length;if(!(arguments.length<2)){for(u=n?function(t,n){return function(e){var r=Ht(e).CustomEvent;"function"==typeof r?r=new r(t,n):(r=Ht(e).document.createEvent("Event"),r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail),e.dispatchEvent(r)}}:function(t){return function(n){var e=Ht(n).CustomEvent;"function"==typeof e?e=new e(t,{detail:n.detail}):(e=Ht(n).document.createEvent("Event"),e.initEvent(t,n.bubbles,n.cancelable),e.detail=n.detail),n.target.dispatchEvent(e)}},c=0;c<a;++c)this.each(function(t,n,e){var r,i,o,a=n?Zn:Wn.length>2?Kn:Qn;if("function"==typeof e)r=a(t,n,e);else if(e)r=a(t,n,(i=e,function(t){var n=Ht(t).CustomEvent;return"function"==typeof n?n=new n(i,{detail:t.detail}):(n=Ht(t).document.createEvent("Event"),n.initEvent(i,t.bubbles,t.cancelable),n.detail=t.detail),t.target.dispatchEvent(n)}));else{for(o=0;o<t.length;++o)if((r=t[o]).type.toLowerCase()===n.toLowerCase()){r.value=null;break}r||(r={type:n,name:null,value:null,listener:null},t.push(r))}r.value=e,r.listener=null}(jn.call(this,t),n,e));return this}var u,c;if(c=o[0],r=this.node().__on,r)for(var f,s=0,l=r.length;s<l;++s)if((f=r[s]).type===c.type&&f.name===c.name)return f.value;return null},dispatch:function(t,n){return this.each(("function"==typeof n?function(t,n){return function(){return Ht(this).CustomEvent;}}:function(t,n){return function(){var e=Ht(this).CustomEvent;return"function"==typeof e?e=new e(t,n):(e=Ht(this).document.createEvent("Event"),e.initEvent(t,n.bubbles,n.cancelable),e.detail=n.detail),this.dispatchEvent(e)}})(t,n))},*[Symbol.iterator](){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r,i=t[n],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};var Zn=function(t,n,e){var r=function(t){return function(n){t.call(this,n,this.__data__)}}(e);return t.push({type:n,name:null,value:e,listener:r}),r},Kn=function(t,n,e,r){var i=function(t,n){return function(e){var r=Ht(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail),e.currentTarget.dispatchEvent(i)}}(n,r);return t.push({type:n,name:null,value:e,listener:i}),i},Qn=function(t,n,e){var r=function(t){return function(n){t.call(this,n,this.__data__)}}(e);return t.push({type:n,name:null,value:e,listener:r}),r};function Jn(t,n,e){return arguments.length>1?this.each(("function"==typeof n?function(t,n,e){return function(){var r=Ht(this).CustomEvent;"function"==typeof r?r=new r(t,n):(r=Ht(this).document.createEvent("Event"),r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail),this.dispatchEvent(r)}}:function(t,n){return function(){var e=Ht(this).CustomEvent;"function"==typeof e?e=new e(t,{detail:n}):(e=Ht(this).document.createEvent("Event"),e.initEvent(t,!1,!1),e.detail=n),this.dispatchEvent(e)}})(t,n,e)):this.node().__data__}function te(t){return t}function ne(t){return function(){this.querySelector(t).focus()}}function ee(t){return arguments.length?this.each("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);n&&this.focus(n)}}(t):ne(t)):this.node().focus()}function re(){return this.each((function(){this.blur()}))}function ie(){return this.each((function(){(this.focus||this.select).call(this)}))}function oe(){return this.each((function(){var t=this.getBoundingClientRect();this.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}))}function ae(t){return function(){return this.matches(t)}}function ue(t){return function(n){return n.matches(t)}}var ce=Array.prototype.find;function fe(t){return function(){return ce.call(this.children,t)||null}}function se(t){return new Array(t.length)}function le(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function he(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new le(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function de(t){return new Array(t.length)}function pe(){return new Array(this.length)}function ge(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function ye(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new ge(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function ve(t){return new Array(t.length)}le.prototype={constructor:le,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},ge.prototype={constructor:ge,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var _e=180/Math.PI,be={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function me(t,n,e,r,i,o){var a,u,c;return(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a),(c=t*e+n*r)&&(e-=t*c,r-=n*c),(u=Math.sqrt(e*e+r*r))&&(e/=u,r/=u,c/=u),t*r<n*e&&(t=-t,n=-n,c=-c,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(n,t)*_e,skewX:Math.atan(c)*_e,scaleX:a,scaleY:u}}function xe(t){const n=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?be:me(n.a,n.b,n.c,n.d,n.e,n.f)}function we(t){return null==t?be:(t="function"==typeof t?t:function(t){return function(){return t}}(t),this.attrTween("transform",t))}function Me(t,n){return function(e){return this.getAttribute(t)!==n?this.getAttribute(t):null}}function Te(t,n){return function(e){return this.getAttribute(t)!==n?n:null}}function Ae(t,n){return function(){return this.getAttribute(t)!==n}}function Se(t,n,e){var r,i,o=e+"";return function(){var a=this.getAttribute(t);return a===o?null:a===r?i:i=n(r=a,e)}}function Ee(t,n,e){return function(){var r=this.getAttribute(t);return r===e?null:n(r,e)}}function Ne(t,n,e,r,i,o){var a,u,c=n._tweenValue;return function(f){var s=this.getAttribute(t);if(s!==e){if(u!==s||c!==e)a=n(u=s,c=e);else if(a)return a;if(!a)return void(u=s)}return a?a.call(this,f):void 0}}function ke(t,n){var e;return("number"==typeof n?function(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}:"string"==typeof n?(e=n,function(t,n){return function(e){var r=n.call(this,e);return null==r?this.removeAttribute(t):this.setAttribute(t,r)}}(t,e)):function(t,n){return function(e){var r=n.call(this,e);return null==r?this.removeAttribute(t):this.setAttribute(t,r+"")}})(t,n)}function Ce(t,n){return function(e){return this.style.getPropertyValue(t)!==n?this.style.getPropertyValue(t):null}}function Pe(t,n,e){return function(r){return this.style.getPropertyValue(t)!==n?n:null}}function ze(t,n,e){var r,i,o=e+"";return function(){var a=Wt(this,t);return a===o?null:a===r?i:i=n(r=a,e)}}function $e(t,n,e){return function(){var r=Wt(this,t);return r===e?null:n(r,e)}}function De(t,n,e,r,i,o){var a,u,c=n._tweenValue;return function(f){var s=Wt(this,t);if(s!==e){if(u!==s||c!==e)a=n(u=s,c=e);else if(a)return a;if(!a)return void(u=s)}return a?a.call(this,f):void 0}}function Re(t,n,e){var r;return("number"==typeof e?function(t,n){return function(e){this.style.setProperty(t,n.call(this,e),null)}}:"string"==typeof e?(r=e,function(t,n){return function(e){var r=n.call(this,e);return null==r?this.style.removeProperty(t):this.style.setProperty(t,r+"",null)}}(t,r)):function(t,n){return function(e){var r=n.call(this,e);return null==r?this.style.removeProperty(t):this.style.setProperty(t,r,null)}})(t,n)}function Fe(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function qe(t){return Vn().transition(t)}function Ue(){return++Xe}function Ie(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Oe(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}function Be(t){return(1-Math.cos(Ye*t))/2}function Ye(){return Math.PI}function Le(t){return t}function je(){var t,n,e=Le,r=Ie,i=null,o=null,a=null,u=null;function c(c){var f=c.length,s=new Array(f),l=new Array(f),h=new Array(f);for(var d=0;d<f;++d){var p=c[d];s[d]=+e.call(null,p,d,c),l[d]=+r.call(null,p,d,c),h[d]=n.call(null,p,d,c)}return function(n){var e=Math.max(0,Math.min(1,n));if(e===0)return s.slice();if(e===1)return l.slice();for(var r=new Array(f),d=0;d<f;++d)r[d]=s[d]*(1-n)+l[d]*n;return r}}return c.duration=function(n){return arguments.length?(t=+n,c):t},c.ease=function(t){return arguments.length?(r=t,c):r},c.interpolate=function(t){return arguments.length?(n=t,c):n},c.range=function(t){return arguments.length?(e=Le,r=t,c):[e,r]},c.rangeRound=function(t){return e=Le,r=t,n=function(t,n){var e=n-t;return e?function(n){return Math.round(t+n*e)}:function(){return t}}),c},c.clamp=function(t){return arguments.length?(a=t,c):a},c.interpolate=function(t){return arguments.length?(u=t,c):u},c}function He(t,n){return n-=t=+t,function(e){return t+n*e}}function Xe(t,n){var e,r=n-t;return r?He(t,r>180||r<-180?(r=r-360*Math.round(r/360),r):r):function(){return t}}function Ge(t){return 1===(t=+t)?Ve:function(n,e){return e-n?function(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}(n,e,t):function(){return n}}}function Ve(t,n){var e=n-t;return e?He(t,e):function(){return t}}var We=function t(n){var e=Ge(n);function r(t,n){var r=e((t=Ot(t)).r,(n=Ot(n)).r),i=e(t.g,n.g),o=e(t.b,n.b),a=Ve(t.opacity,n.opacity);return function(n){return t.r=r(n),t.g=i(n),t.b=o(n),t.opacity=a(n),t+""}}return r.gamma=t,r}(1);function Ze(t,n){n||(n=[]);var e,r=t?Math.min(n.length,t.length):0,i=n.slice();return function(o){for(e=0;e<r;++e)i[e]=t[e]*(1-o)+n[e]*o;return i}}function Ke(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Qe(t,n){var e,r=n?n.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(e=0;e<i;++e)o[e]=or(t[e],n[e]);for(;e<r;++e)a[e]=n[e];return function(t){for(e=0;e<i;++e)a[e]=o[e](t);return a}}function Je(t,n){var e=new Date;return n-=t=+t,function(r){return e.setTime(t+n*r),e}}function tr(t,n){return n-=t=+t,function(e){return t+n*e}}function nr(t,n){var e,r={},i={}; Function truncated due to length. "
            console.log("D3.js v7.9.0 loaded for offline functionality");
        });
    </script>
    <div class="container">
        <!-- Left Sidebar: File Manager -->
        <div class="sidebar">
            <div class="section">
                <h3>Files</h3>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div>üìÅ Drop files here or click to upload</div>
                    <div style="font-size: 0.875rem; color: #94a3b8; margin-top: 0.5rem;">
                        Supports .txt and .csv files
                    </div>
                </div>
                <input type="file" id="fileInput" style="display: none;" multiple accept=".txt,.csv">
                <div id="fileList"></div>
            </div>
            
            <div class="stats" id="stats">
                <div>üìä System Stats</div>
                <div id="statsContent">
                    Files: 0 | Tags: 0
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <div class="section">
                <h2>ORCS Intelligence System</h2>
                <div id="welcomeMessage" class="content-area">
Welcome to the ORCS Intelligence System - Portable Edition

This is a standalone version that runs entirely in your browser. No installation required.

Features:
‚Ä¢ Upload and analyze text/CSV files
‚Ä¢ Create tags for entities, relationships, attributes
‚Ä¢ Track connections between intelligence elements
‚Ä¢ Generate ORCS cards with metadata
‚Ä¢ Search and cross-reference information

To get started:
1. Upload files using the sidebar
2. Select text to create tags
3. Build relationships between entities
4. Export your analysis

All data is stored locally in your browser.
                </div>
            </div>
            
            <div class="section" id="documentSection" style="display: none;">
                <h3 id="documentTitle">Document Content</h3>
                <div id="documentContent" class="content-area"></div>
                
                <div id="tagToolbar" style="display: none; background: #334155; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <div>Selected: "<span id="selectedText"></span>"</div>
                    <div style="margin-top: 0.5rem;">
                        <button class="btn" onclick="createTag('entity')">üìç Entity</button>
                        <button class="btn" onclick="createTag('relationship')">üîó Relationship</button>
                        <button class="btn" onclick="createTag('attribute')">üè∑Ô∏è Attribute</button>
                        <button class="btn" onclick="createTag('comment')">üí¨ Comment</button>
                        <button class="btn" onclick="createTag('kv_pair')">üîë Key:Value</button>
                        <button class="btn btn-danger" onclick="clearSelection()">‚ùå Clear</button>
                    </div>
                </div>
            </div>
            
            <div class="section" id="graphSection">
                <h3>Relationship Graph</h3>
                <div class="graph-area" id="graphArea">
                    <div style="text-align: center; padding-top: 150px; color: #64748b;">
                        üìä Relationship graph will appear here as you create tags and connections
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar: Tags -->
        <div class="tag-panel">
            <div class="section">
                <h3>Tags</h3>
                <div id="tagList"></div>
            </div>
            
            <div class="section">
                <h3>Find Similar</h3>
                <button class="btn" onclick="findSimilarTags()" style="width: 100%;">üîç Find Duplicates</button>
                <div id="similarTags"></div>
            </div>
        </div>
    </div>
    
    <!-- Tag Creation Modal -->
    <div class="modal" id="tagModal">
        <div class="modal-content">
            <h3 id="tagModalTitle">Create Tag</h3>
            <form id="tagForm">
                <div>
                    <label>Name:</label>
                    <input type="text" id="tagName" class="input" required>
                </div>
                <div>
                    <label>Type:</label>
                    <select id="tagType" class="input">
                        <option value="entity">Entity</option>
                        <option value="relationship">Relationship</option>
                        <option value="attribute">Attribute</option>
                        <option value="comment">Comment</option>
                        <option value="kv_pair">Key:Value Pair</option>
                    </select>
                </div>
                <div>
                    <label>Description:</label>
                    <textarea id="tagDescription" class="input" rows="3"></textarea>
                </div>
                <div>
                    <label>Aliases (comma-separated):</label>
                    <input type="text" id="tagAliases" class="input">
                </div>
                <div style="margin-top: 1rem;">
                    <button type="submit" class="btn">üíæ Save Tag</button>
                    <button type="button" class="btn btn-danger" onclick="closeTagModal()">‚ùå Cancel</button>
                </div>
            </form>
        </div>
    </div>


        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            updateStats();
            renderFileList();
            renderTagList();
            
            // File upload handler
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('tagForm').addEventListener('submit', handleTagSubmit);
            
            // Enable text selection
            document.addEventListener('mouseup', handleTextSelection);
        });
        
        // File management
        function handleFileUpload(event) {
            const fileList = event.target.files;
            
            for (let file of fileList) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileId = generateId();
                    const fileName = file.name;
                    const content = e.target.result;
                    
                    files[fileId] = {
                        id: fileId,
                        name: fileName,
                        content: content,
                        created: new Date().toISOString(),
                        tags: []
                    };
                    
                    saveToStorage();
                    renderFileList();
                    updateStats();
                };
                reader.readAsText(file);
            }
        }
        
        function selectFile(fileId) {
            currentFile = fileId;
            const file = files[fileId];
            
            document.getElementById('documentTitle').textContent = file.name;
            document.getElementById('documentContent').innerHTML = highlightTags(file.content, fileId);
            document.getElementById('documentSection').style.display = 'block';
            document.getElementById('welcomeMessage').style.display = 'none';
            
            // Update active file in sidebar
            document.querySelectorAll('.file-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`[data-file-id="${fileId}"]`).classList.add('active');
        }
        
        // Text selection and tagging
        function handleTextSelection() {
            const selection = window.getSelection();
            const text = selection.toString().trim();
            
            if (text && currentFile) {
                selectedText = {
                    text: text,
                    range: selection.getRangeAt(0)
                };
                
                document.getElementById('selectedText').textContent = text;
                document.getElementById('tagToolbar').style.display = 'block';
            } else {
                clearSelection();
            }
        }
        
        function clearSelection() {
            selectedText = null;
            document.getElementById('tagToolbar').style.display = 'none';
            window.getSelection().removeAllRanges();
        }
        
        function createTag(type) {
            if (!selectedText || !currentFile) return;
            
            currentTagType = type;
            document.getElementById('tagModalTitle').textContent = `Create ${type.charAt(0).toUpperCase() + type.slice(1)} Tag`;
            document.getElementById('tagType').value = type;
            document.getElementById('tagName').value = selectedText.text;
            document.getElementById('tagModal').classList.add('active');
        }
        
        function handleTagSubmit(event) {
            event.preventDefault();
            
            if (!selectedText || !currentFile) return;
            
            const tagId = generateId();
            const tagData = {
                id: tagId,
                name: document.getElementById('tagName').value,
                type: document.getElementById('tagType').value,
                description: document.getElementById('tagDescription').value,
                aliases: document.getElementById('tagAliases').value.split(',').map(a => a.trim()).filter(a => a),
                text: selectedText.text,
                fileId: currentFile,
                created: new Date().toISOString()
            };
            
            tags[tagId] = tagData;
            files[currentFile].tags.push(tagId);
            
            saveToStorage();
            renderTagList();
            updateStats();
            selectFile(currentFile); // Refresh document with highlights
            closeTagModal();
            clearSelection();
        }
        
        function closeTagModal() {
            document.getElementById('tagModal').classList.remove('active');
            document.getElementById('tagForm').reset();
        }
        
        // Tag highlighting
        function highlightTags(content, fileId) {
            if (!files[fileId] || !files[fileId].tags) return content;
            
            let highlightedContent = content;
            const fileTags = files[fileId].tags.map(tagId => tags[tagId]).filter(tag => tag);
            
            // Sort tags by text length (longest first) to avoid overlapping highlights
            fileTags.sort((a, b) => b.text.length - a.text.length);
            
            fileTags.forEach(tag => {
                const regex = new RegExp(escapeRegex(tag.text), 'gi');
                highlightedContent = highlightedContent.replace(regex, 
                    `<span class="tag-highlight ${tag.type}" title="${tag.name} (${tag.type})" onclick="selectTag('${tag.id}')">${tag.text}</span>`
                );
            });
            
            return highlightedContent;
        }
        
        function selectTag(tagId) {
            const tag = tags[tagId];
            if (!tag) return;
            
            alert(`Tag: ${tag.name}\nType: ${tag.type}\nDescription: ${tag.description || 'No description'}\nAliases: ${tag.aliases.join(', ') || 'None'}`);
        }
        
        // Similar tag detection
        function findSimilarTags() {
            const tagValues = Object.values(tags);
            const similar = {};
            
            tagValues.forEach(tag1 => {
                tagValues.forEach(tag2 => {
                    if (tag1.id !== tag2.id && tag1.type === tag2.type) {
                        const similarity = calculateSimilarity(tag1, tag2);
                        if (similarity > 0.7) {
                            if (!similar[tag1.id]) similar[tag1.id] = [];
                            similar[tag1.id].push({ tag: tag2, similarity });
                        }
                    }
                });
            });
            
            renderSimilarTags(similar);
        }
        
        function calculateSimilarity(tag1, tag2) {
            const name1 = tag1.name.toLowerCase();
            const name2 = tag2.name.toLowerCase();
            
            if (name1 === name2) return 1.0;
            if (name1.includes(name2) || name2.includes(name1)) return 0.8;
            
            // Check aliases
            const aliases1 = tag1.aliases.map(a => a.toLowerCase());
            const aliases2 = tag2.aliases.map(a => a.toLowerCase());
            
            for (let alias1 of aliases1) {
                if (aliases2.includes(alias1) || alias1.includes(name2) || name2.includes(alias1)) {
                    return 0.9;
                }
            }
            
            return 0;
        }
        
        function renderSimilarTags(similar) {
            const container = document.getElementById('similarTags');
            container.innerHTML = '';
            
            if (Object.keys(similar).length === 0) {
                container.innerHTML = '<div style="color: #64748b; font-style: italic;">No similar tags found</div>';
                return;
            }
            
            Object.entries(similar).forEach(([tagId, matches]) => {
                const tag = tags[tagId];
                const div = document.createElement('div');
                div.className = 'similarity-match';
                div.innerHTML = `
                    <div style="font-weight: bold;">${tag.name}</div>
                    <div style="font-size: 0.875rem;">Similar to: ${matches.map(m => m.tag.name).join(', ')}</div>
                    <button class="btn" onclick="mergeTags(['${tagId}', ${matches.map(m => `'${m.tag.id}'`).join(', ')}])" style="margin-top: 0.5rem;">üîó Merge</button>
                `;
                container.appendChild(div);
            });
        }
        
        function mergeTags(tagIds) {
            if (tagIds.length < 2) return;
            
            const masterTag = tags[tagIds[0]];
            const mergeConfirm = confirm(`Merge ${tagIds.length} tags into "${masterTag.name}"?`);
            
            if (!mergeConfirm) return;
            
            // Combine aliases and update master tag
            const allAliases = new Set(masterTag.aliases);
            
            tagIds.slice(1).forEach(tagId => {
                const tag = tags[tagId];
                tag.aliases.forEach(alias => allAliases.add(alias));
                
                // Remove merged tag from files
                Object.values(files).forEach(file => {
                    const index = file.tags.indexOf(tagId);
                    if (index > -1) {
                        file.tags.splice(index, 1);
                        if (!file.tags.includes(masterTag.id)) {
                            file.tags.push(masterTag.id);
                        }
                    }
                });
                
                delete tags[tagId];
            });
            
            masterTag.aliases = Array.from(allAliases);
            
            saveToStorage();
            renderTagList();
            updateStats();
            if (currentFile) selectFile(currentFile);
            findSimilarTags();
        }
        
        // Rendering functions
        function renderFileList() {
            const container = document.getElementById('fileList');
            container.innerHTML = '';
            
            Object.values(files).forEach(file => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.setAttribute('data-file-id', file.id);
                div.innerHTML = `
                    <div>${file.name}</div>
                    <div style="font-size: 0.75rem; color: #94a3b8;">${file.tags.length} tags</div>
                `;
                div.onclick = () => selectFile(file.id);
                container.appendChild(div);
            });
        }
        
        function renderTagList() {
            const container = document.getElementById('tagList');
            container.innerHTML = '';
            
            Object.values(tags).forEach(tag => {
                const div = document.createElement('div');
                div.className = `tag-item ${tag.type}`;
                div.innerHTML = `
                    <div>${tag.name}</div>
                    <div style="font-size: 0.75rem; opacity: 0.8;">${tag.type}</div>
                `;
                div.onclick = () => selectTag(tag.id);
                container.appendChild(div);
            });
        }
        
        function updateStats() {
            const fileCount = Object.keys(files).length;
            const tagCount = Object.keys(tags).length;
            
            document.getElementById('statsContent').innerHTML = `Files: ${fileCount} | Tags: ${tagCount}`;
        }
        
        // Storage functions
        function saveToStorage() {
            localStorage.setItem('orcs_files', JSON.stringify(files));
            localStorage.setItem('orcs_tags', JSON.stringify(tags));
        }
        
        function loadFromStorage() {
            const storedFiles = localStorage.getItem('orcs_files');
            const storedTags = localStorage.getItem('orcs_tags');
            
            if (storedFiles) files = JSON.parse(storedFiles);
            if (storedTags) tags = JSON.parse(storedTags);
        }
        
        // Utility functions
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // Export functionality
        function exportData() {
            const data = {
                files: files,
                tags: tags,
                exported: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'orcs-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Add export button to stats
        document.getElementById('stats').innerHTML += '<button class="btn" onclick="exportData()" style="margin-top: 0.5rem; width: 100%;">üíæ Export Data</button>';
    </script>
</body>
</html>